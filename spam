#!/data/data/com.termux/files/usr/bin/bash

# Màu sắc
RED='\033[0;31m'
GREEN='\033[0;32m'
CYAN='\033[0;36m'
YELLOW='\033[1;33m'
BLUE='\033[1;34m'
RESET='\033[0m'

# In banner
banner() {
  clear
  echo -e "${CYAN}"
  echo "╔═════════════════════════════════════════╗"
  echo "║          DISCORD WEBHOOK SPAMMER       ║"
  echo "║         Made by Shinichi - Termux      ║"
  echo "╚═════════════════════════════════════════╝"
  echo -e "${RESET}"
}

# Biến toàn cục
custom_webhook=""
bot_webhook=""

# Nhập Webhook
input_webhook() {
  clear
  banner
  echo -e "${CYAN}Nhập Webhook URL:${RESET}"
  read -r custom_webhook
  if [[ "$custom_webhook" == https://discord.com/api/webhooks/* ]]; then
    echo -e "${GREEN}Đã lưu Webhook: $custom_webhook${RESET}"
  else
    echo -e "${RED}Webhook không hợp lệ!${RESET}"
    custom_webhook=""
  fi
  read -p "$(echo -e "${CYAN}Nhấn Enter để quay lại menu chính...${RESET}")"
}

# Tạo Webhook mới bằng Bot
create_webhook() {
  clear
  banner
  read -p "$(echo -e "${CYAN}Nhập Token Bot: ${RESET}")" bot_token
  read -p "$(echo -e "${CYAN}Nhập Server ID (Guild ID): ${RESET}")" guild_id

  echo -e "${BLUE}Đang lấy danh sách kênh...${RESET}"
  response=$(curl -s -H "Authorization: Bot $bot_token" "https://discord.com/api/v10/guilds/$guild_id/channels")

  channel_ids=($(echo "$response" | jq -r '.[] | select(.type == 0) | .id'))
  channel_names=($(echo "$response" | jq -r '.[] | select(.type == 0) | .name'))

  if [ ${#channel_ids[@]} -eq 0 ]; then
    echo -e "${RED}Không lấy được kênh. Kiểm tra Token hoặc Guild ID.${RESET}"
    read -p "$(echo -e "${CYAN}Nhấn Enter để quay lại menu chính...${RESET}")"
    return
  fi

  echo -e "${GREEN}Danh sách kênh văn bản:${RESET}"
  for i in "${!channel_ids[@]}"; do
    printf "${YELLOW}%s.${RESET} %s (${CYAN}%s${RESET})\n" "$((i+1))" "${channel_names[$i]}" "${channel_ids[$i]}"
  done

  read -p "$(echo -e "${CYAN}Chọn số kênh muốn tạo webhook: ${RESET}")" choice
  index=$((choice - 1))

  if [ "$choice" -ge 1 ] && [ "$choice" -le ${#channel_ids[@]} ]; then
    channel_id="${channel_ids[$index]}"
    read -p "$(echo -e "${CYAN}Đặt tên Webhook: ${RESET}")" webhook_name

    response=$(curl -s -X POST "https://discord.com/api/v10/channels/$channel_id/webhooks" \
      -H "Authorization: Bot $bot_token" \
      -H "Content-Type: application/json" \
      -d "{\"name\": \"$webhook_name\"}")

    bot_webhook=$(echo "$response" | jq -r '.url // empty')

    if [[ "$bot_webhook" == https://discord.com/api/webhooks/* ]]; then
      echo -e "${GREEN}Đã tạo Webhook: $bot_webhook${RESET}"
    else
      echo -e "${RED}Không thể tạo Webhook. Kiểm tra lại.${RESET}"
    fi
  else
    echo -e "${RED}Lựa chọn không hợp lệ.${RESET}"
  fi

  read -p "$(echo -e "${CYAN}Nhấn Enter để quay lại menu chính...${RESET}")"
}

# Spam Webhook
start_spam() {
  clear
  banner
  echo -e "${BLUE}Chọn chế độ spam:${RESET}"
  echo -e "${YELLOW}1.${RESET} Spam webhook thủ công đã nhập"
  echo -e "${YELLOW}2.${RESET} Spam webhook tạo từ bot"
  echo -e "${YELLOW}3.${RESET} Spam cả hai"
  echo -e "${YELLOW}4.${RESET} Quay lại"

  read -p "$(echo -e "${CYAN}Chọn (1-4):${RESET} ")" mode

  read -p "$(echo -e "${CYAN}Nội dung cần spam: ${RESET}")" content
  read -p "$(echo -e "${CYAN}Số lần spam: ${RESET}")" count

  for ((i = 1; i <= count; i++)); do
    [[ "$mode" == "1" || "$mode" == "3" ]] && [ -n "$custom_webhook" ] && \
      curl -s -X POST -H "Content-Type: application/json" -d "{\"content\": \"$content\"}" "$custom_webhook" > /dev/null

    [[ "$mode" == "2" || "$mode" == "3" ]] && [ -n "$bot_webhook" ] && \
      curl -s -X POST -H "Content-Type: application/json" -d "{\"content\": \"$content\"}" "$bot_webhook" > /dev/null

    echo -e "${YELLOW}[$i/$count] Đã gửi.${RESET}"
    sleep 0.1
  done
  read -p "$(echo -e "${CYAN}Nhấn Enter để quay lại menu chính...${RESET}")"
}

# Trợ giúp
help_menu() {
  clear
  banner
  echo -e "${BLUE}--- Danh sách tuỳ chọn ---${RESET}"
  echo -e "${YELLOW}1.${RESET} Nhập webhook thủ công"
  echo -e "${YELLOW}2.${RESET} Tạo webhook từ bot"
  echo -e "${YELLOW}3.${RESET} Spam webhook"
  echo -e "${YELLOW}4.${RESET} Trợ giúp"
  echo -e "${YELLOW}5.${RESET} Thoát"
  echo -e "${CYAN}Trong spam:${RESET}"
  echo -e "${GREEN}1${RESET} - Dùng webhook thủ công"
  echo -e "${GREEN}2${RESET} - Dùng webhook bot"
  echo -e "${GREEN}3${RESET} - Dùng cả hai"
  echo -e "${GREEN}4${RESET} - Quay lại"
  read -p "$(echo -e "${CYAN}Nhấn Enter để quay lại...${RESET}")"
}

# Menu chính
while true; do
  banner
  echo -e "${BLUE}Chọn một chức năng:${RESET}"
  echo -e "${YELLOW}1.${RESET} Nhập Webhook thủ công"
  echo -e "${YELLOW}2.${RESET} Tạo Webhook từ Bot"
  echo -e "${YELLOW}3.${RESET} Spam Webhook"
  echo -e "${YELLOW}4.${RESET} /help - Trợ giúp"
  echo -e "${YELLOW}5.${RESET} Thoát"
  read -p "$(echo -e "${CYAN}Chọn (1-5):${RESET} ")" choice

  case $choice in
    1) input_webhook ;;
    2) create_webhook ;;
    3) start_spam ;;
    4) help_menu ;;
    5) exit ;;
    *) echo -e "${RED}Lựa chọn không hợp lệ.${RESET}" ;;
  esac
done
