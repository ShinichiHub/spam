#!/data/data/com.termux/files/usr/bin/bash

GREEN="\e[92m"
BLUE="\e[94m"
CYAN="\e[96m"
RED="\e[91m"
RESET="\e[0m"

i=0

banner() {
  echo -e "${CYAN}=====================================${RESET}"
  echo -e "${BLUE}         TOOL SPAM WEBHOOK           ${RESET}"
  echo -e "${CYAN}=====================================${RESET}"
}

input_webhook() {
  read -p "$(echo -e "${GREEN}Nhập nội dung cần gửi:${RESET} ")" MESSAGE
  read -p "$(echo -e "${GREEN}Nhập số lần gửi (0 = vô hạn):${RESET} ")" COUNT
  read -p "$(echo -e "${GREEN}Nhập Webhook URL:${RESET} ")" WEBHOOK
}

send_webhook() {
  curl -s -H "Content-Type: application/json" -X POST \
    -d "{\"content\":\"$MESSAGE\"}" "$1" > /dev/null
  ((i++))
}

show_stats() {
  while true; do
    clear
    echo -e "${CYAN}============== Shinichi Hub ==============${RESET}"
    echo -e "${GREEN}RAM Usage:$(free -h | awk '/Mem/ {print " " $3 "/" $2}')${RESET}"
    echo -e "${GREEN}Sent Messages: $i${RESET}"
    echo -e "${CYAN}==========================================${RESET}"
    sleep 1
  done
}

start_spam_single() {
  show_stats & STATS_PID=$!
  if [[ "$COUNT" -eq 0 ]]; then
    while true; do
      send_webhook "$WEBHOOK"
    done
  else
    for ((j = 1; j <= COUNT; j++)); do
      send_webhook "$WEBHOOK"
    done
  fi
  kill $STATS_PID
}

input_create() {
  read -p "$(echo -e "${GREEN}Nhập Bot Token:${RESET} ")" BOT_TOKEN
  read -p "$(echo -e "${GREEN}Nhập Channel ID:${RESET} ")" CHANNEL_ID
  read -p "$(echo -e "${GREEN}Số webhook muốn tạo:${RESET} ")" CREATE_COUNT
  read -p "$(echo -e "${GREEN}Nhập nội dung cần gửi:${RESET} ")" MESSAGE
  read -p "$(echo -e "${GREEN}Nhập số lần gửi (0 = vô hạn):${RESET} ")" COUNT
}

create_webhooks() {
  WEBHOOKS=()
  for ((j = 1; j <= CREATE_COUNT; j++)); do
    NAME="Webhook-$j"
    RESPONSE=$(curl -s -X POST "https://discord.com/api/v10/channels/$CHANNEL_ID/webhooks" \
      -H "Authorization: Bot $BOT_TOKEN" \
      -H "Content-Type: application/json" \
      -d "{\"name\": \"$NAME\"}")
    URL=$(echo "$RESPONSE" | grep -o 'https://discord.com/api/webhooks/[^\"]*')
    if [[ $URL == https://* ]]; then
      WEBHOOKS+=("$URL")
      echo -e "${GREEN}[+] Tạo webhook $j thành công: $URL${RESET}"
    else
      echo -e "${RED}[-] Tạo webhook $j thất bại: $RESPONSE${RESET}"
    fi
  done
  SAVE_WEBHOOKS=("${WEBHOOKS[@]}")
}

start_spam_multi() {
  if [[ ${#SAVE_WEBHOOKS[@]} -eq 0 ]]; then
    echo "Chưa có webhook nào được tạo!"
    return
  fi
  show_stats & STATS_PID=$!
  if [[ "$COUNT" -eq 0 ]]; then
    while true; do
      for URL in "${SAVE_WEBHOOKS[@]}"; do
        send_webhook "$URL"
      done
    done
  else
    for ((j = 1; j <= COUNT; j++)); do
      for URL in "${SAVE_WEBHOOKS[@]}"; do
        send_webhook "$URL"
      done
    done
  fi
  kill $STATS_PID
}

start_spam_both() {
  if [[ -z "$WEBHOOK" || ${#SAVE_WEBHOOKS[@]} -eq 0 ]]; then
    echo "Thiếu webhook hoặc chưa tạo webhook nào!"
    return
  fi
  show_stats & STATS_PID=$!
  if [[ "$COUNT" -eq 0 ]]; then
    while true; do
      send_webhook "$WEBHOOK"
      for URL in "${SAVE_WEBHOOKS[@]}"; do
        send_webhook "$URL"
      done
    done
  else
    for ((j = 1; j <= COUNT; j++)); do
      send_webhook "$WEBHOOK"
      for URL in "${SAVE_WEBHOOKS[@]}"; do
        send_webhook "$URL"
      done
    done
  fi
  kill $STATS_PID
}

while true; do
  clear
  banner
  echo -e "${BLUE}1.${RESET} Nhập webhook có sẵn"
  echo -e "${BLUE}2.${RESET} Tạo webhook từ Bot"
  echo -e "${BLUE}3.${RESET} Thoát"
  read -p "$(echo -e "${CYAN}Chọn (1-3):${RESET} ")" choice
  case $choice in
    1)
      input_webhook
      read -p "$(echo -e "${CYAN}Nhấn Enter để chọn chế độ spam...${RESET}")"
      ;;
    2)
      input_create
      create_webhooks
      read -p "$(echo -e "${CYAN}Nhấn Enter để chọn chế độ spam...${RESET}")"
      ;;
    3)
      echo "Thoát tool!"
      exit
      ;;
    *)
      echo "Lựa chọn không hợp lệ!"
      ;;
  esac

  while true; do
    clear
    banner
    echo -e "${BLUE}1.${RESET} Spam webhook đã nhập"
    echo -e "${BLUE}2.${RESET} Spam webhook đã tạo"
    echo -e "${BLUE}3.${RESET} Spam cả hai (đã nhập + đã tạo)"
    echo -e "${BLUE}4.${RESET} Quay lại"
    read -p "$(echo -e "${CYAN}Chọn (1-4):${RESET} ")" spam_choice
    case $spam_choice in
      1) start_spam_single; break ;;
      2) start_spam_multi; break ;;
      3) start_spam_both; break ;;
      4) break ;;
      *) echo "Sai lựa chọn!" ;;
    esac
  done
done
